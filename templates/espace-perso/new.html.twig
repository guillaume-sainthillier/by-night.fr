{% extends 'espace-perso/layout.html.twig' %}

{% block titre 'Créer un nouvel événement' %}
{% block meta_title 'Nouvel événement' %}

{% block breadcrumb_espace -%}
    {% do menu.addItem('Nouveau', url('app_event_new')) %}
{%- endblock %}

{% block body -%}
    <div class="mb-4 mon_evenement">
        {% block body_form %}
            {{ form_start(form) }}
            {{ form_errors(form) }}
            <div class="row">
                <div class="col-md-6">
                    {# Part 1 #}
                    <twig:Card header="Votre événement" icon="lucide:file-text" showFooter="{{ false }}">
                        {{ form_row(form.name, {icon_prepend: 'lucide:file-edit'}) }}
                        {{ form_row(form.description) }}
                        {{ form_row(form.imageFile) }}
                        {{ form_row(form.category, {icon_prepend: 'lucide:drama'}) }}
                        {{ form_row(form.theme, {icon_prepend: 'lucide:shield'}) }}
                        {{ form_row(form.prices, {icon_prepend: 'lucide:ticket'}) }}
                    </twig:Card>

                    {# Part 4 #}
                    <twig:Card header="Communiquez" icon="lucide:megaphone" showFooter="{{ false }}">
                        {{ form_row(form.websiteContacts) }}
                        {{ form_row(form.phoneContacts) }}
                        {{ form_row(form.emailContacts) }}

                        {% if form.comment is defined %}
                            {{ form_row(form.comment) }}
                        {% endif %}
                    </twig:Card>
                </div>
                <div class="col-md-6">
                    {# Part 2 #}
                    <twig:Card header="Dates et horaires" icon="lucide:calendar-days" showFooter="{{ false }}">
                        {{ form_row(form.startDate) }}
                        {{ form_row(form.endDate) }}
                        {{ form_row(form.shortcut, {label: 'Dates', icon_prepend: 'lucide:calendar-days'}) }}
                        {{ form_row(form.hours, {icon_prepend: 'lucide:clock'}) }}

                        {# Event Scheduler Component #}
                        <div class="form-group">
                            <label class="form-label">Horaires</label>
                            <div id="event-scheduler-root"
                                 data-start-date-field="{{ form.startDate.vars.id }}"
                                 data-end-date-field="{{ form.endDate.vars.id }}"
                                 data-collection-id="{{ form.timesheets.vars.id }}"
                                 data-detect-existing="{{ event is defined and event.timesheets|length > 0 ? 'true' : 'false' }}">
                                <p class="text-muted">Chargement...</p>
                            </div>
                        </div>

                        {{ form_row(form.timesheets) }}
                    </twig:Card>

                    {# Part 3 #}
                    <twig:Card header="Lieux" icon="lucide:map-pinned" showFooter="{{ false }}">
                        {{ form_errors(form.place) }}
                        {{ form_row(form.place.name, {icon_prepend: 'lucide:map-pin'}) }}
                        {{ form_row(form.address, {icon_prepend: 'lucide:crosshair'}) }}

                        {{ form_row(form.place.street) }}
                        {{ form_errors(form.place.city) }}
                        <div class="row">
                            <div class="col-md-4">{{ form_row(form.place.city.postalCode) }}</div>
                            <div class="col-md-8">{{ form_row(form.place.city.name) }}</div>
                        </div>

                        {{ form_row(form.place.country) }}
                        <twig:block name="body_after">
                            <div class="card-body p-0">
                                <div id="map" data-map-id="{{ googleMapId }}" data-api-key="{{ googleMapKey }}"></div>
                            </div>
                        </twig:block>

                    </twig:Card>
                </div>
            </div>
            <hr />
            <div class="mt-2">
                <a class="btn btn-outline-secondary" href="{{ path('app_event_list') }}" title="Retourner à mes soirées">
                    <twig:Icon name="lucide:chevron-left" />
                    Retour
                </a>
                <button type="submit" class="ms-2 btn btn-primary">
                    <twig:Icon name="lucide:save" />
                    Sauvegarder
                </button>
            </div>

            {{ form_rest(form) }}
            {{ form_end(form) }}
        {% endblock %}
    </div>
{%- endblock %}

{% block css -%}
    {{ encore_entry_link_tags('espace_perso_event') }}
{%- endblock %}

{% block js -%}
    {{ encore_entry_script_tags('espace_perso_event') }}
{%- endblock %}
