# Read the documentation: https://github.com/FriendsOfSymfony/FOSElasticaBundle/blob/master/Resources/doc/setup.md
fos_elastica:
    clients:
        default:
            host: '%env(ES_HOST)%'
            port: '%env(ES_PORT)%'
            compression: true

    messenger: ~
    serializer:
        serializer: jms_serializer

    indexes:
        event:
            indexable_callback: "isIndexable"
            settings:
                analysis:
                    filter:
                        french_elision:
                            type: "elision"
                            articles_case: true
                            articles: [ "l", "m", "t", "qu", "n", "s", "j", "d", "c", "jusqu", "quoiqu", "lorsqu", "puisqu" ]
                        french_stop:
                            type: stop
                            stopwords: _french_
                        french_stemmer:
                            type: "stemmer"
                            language: "light_french"
                        nGram:
                            type: "edge_ngram"
                            min_gram: 3
                            max_gram: 10
                    analyzer:
                        autocomplete:
                            tokenizer: "icu_tokenizer"
                            filter:
                                - "french_elision"
                                - "icu_folding"
                                - "lowercase"
                                - "french_stop"
                        french_heavy:
                            tokenizer: "icu_tokenizer"
                            filter:
                                - "french_elision"
                                - "icu_folding"
                                - "lowercase"
                                - "french_stop"
                                - "french_stemmer"
                                - "nGram"
                        french_heavy_natural:
                            tokenizer: "icu_tokenizer"
                            filter:
                                - "icu_folding"
                                - "lowercase"
                                - "nGram"
                        french_heavy_description:
                            tokenizer: "icu_tokenizer"
                            char_filter:
                                - "html_strip"
                            filter:
                                - "french_elision"
                                - "icu_folding"
                                - "lowercase"
                                - "french_stop"
                                - "french_stemmer"
                        french_light:
                            tokenizer: "icu_tokenizer"
                            char_filter:
                                - "html_strip"
                            filter:
                                - "french_elision"
                                - "icu_folding"
                                - "lowercase"
                                - "french_stop"

            persistence:
                model: App\Entity\Event
                repository: App\SearchRepository\EventElasticaRepository
                listener:
                    insert: true
                    update: true
                    delete: true
                provider:
                    query_builder_method: createIsActiveQueryBuilder
                    batch_size: 500
            serializer:
                groups: [ list_event ]
            properties:
                name: { boost: 5, type: "text", analyzer: french_heavy, search_analyzer: autocomplete }
                description: { analyzer: french_heavy_description, search_analyzer: autocomplete }
                start_date: { type: "date", format: 'yyyy-MM-dd' }
                end_date: { type: "date", format: 'yyyy-MM-dd' }
                place:
                    type: "object"
                    properties:
                        name: { boost: 3, type: "text", analyzer: french_heavy_natural, search_analyzer: autocomplete }
                        street: { analyzer: french_heavy_natural, search_analyzer: autocomplete }
                        city_name: { boost: 2, type: "text", analyzer: french_heavy_natural, search_analyzer: autocomplete }
                        city:
                            type: "object"
                            properties:
                                location: { type: "geo_point" }

        city:
            settings:
                analysis:
                    filter:
                        nGram:
                            type: edge_ngram
                            min_gram: 1
                            max_gram: 20
                        french_elision:
                            type: "elision"
                            articles_case: true
                            articles: [ "l", "m", "t", "qu", "n", "s", "j", "d", "c", "jusqu", "quoiqu", "lorsqu", "puisqu" ]
                    analyzer:
                        autocomplete:
                            tokenizer: "icu_tokenizer"
                            filter:
                                - "icu_folding"
                                - "lowercase"
                        city_analyzer:
                            tokenizer: "icu_tokenizer"
                            filter:
                                - "french_elision"
                                - "icu_folding"
                                - "lowercase"
                                - "nGram"

            serializer:
                groups: [ list_city ]
            properties:
                name: { type: "text", boost: 3, analyzer: city_analyzer, search_analyzer: autocomplete }
                country:
                    type: "object"
                    properties:
                        name: { boost: 5, type: "text", analyzer: city_analyzer, search_analyzer: autocomplete }
                parent:
                    type: "object"
                    properties:
                        name: { type: "text", analyzer: city_analyzer, search_analyzer: autocomplete }
            persistence:
                driver: orm
                model: App\Entity\City
                repository: App\SearchRepository\CityElasticaRepository
                provider:
                    batch_size: 500
        user:
            settings:
                analysis:
                    filter:
                        nGram:
                            type: edge_ngram
                            min_gram: 3
                            max_gram: 20
                    analyzer:
                        autocomplete:
                            tokenizer: "icu_tokenizer"
                            filter:
                                - "icu_folding"
                                - "lowercase"
                        user_analyzer:
                            tokenizer: "icu_tokenizer"
                            filter:
                                - "icu_folding"
                                - "lowercase"
                                - "nGram"
            serializer:
                groups: [ 'elasticsearch:user:details' ]
            properties:
                username: { boost: 5, type: "text", analyzer: user_analyzer, search_analyzer: autocomplete }
                firstname: { boost: 1, type: "text", analyzer: user_analyzer, search_analyzer: autocomplete }
                lastname: { boost: 3, type: "text", analyzer: user_analyzer, search_analyzer: autocomplete }
            persistence:
                model: App\Entity\User
                repository: App\SearchRepository\UserElasticaRepository
                provider:
                    batch_size: 1000
